## Общие директивы для Copilot / ChatGPT при работе с проектами XAML (.NET + MVVM)

### 1. XAML + code-behind

* При **любом** добавлении или изменении компонентов XAML вноси зеркальные правки в соответствующий `code-behind`-класс.
* При создании `UserControl` публикуй сразу **два** файла: `<Name>.xaml` и `<Name>.xaml.cs`, соблюдая общий неймспейс и публичный API.

---

### 2. Слоистая архитектура (MVVM + инфраструктура)

| Уровень                            | Назначение                                                                       | Допустимые зависимости |
| ---------------------------------- | -------------------------------------------------------------------------------- | ---------------------- |
| **L1 View (+ code-behind)**        | Отображение данных, визуальная логика (биндинги, анимации, обработка UI-событий) | → L2                   |
| **L2 ViewModel**                   | Подготовка / валидация данных, команды UI, **реактивные свойства**               | → L3                   |
| **L3 Helpers / Managers**          | Бизнес-операции, агрегирование доменных объектов, **шина сообщений**             | → L4 / L5              |
| **L4 Data Model (Domain / DTO)**   | Чистые POCO-классы — только поля и **вычисляемые getter’ы**                      | –                      |
| **L5 Data Storage (Repositories)** | Доступ к БД / API под интерфейсом `IRepository*`                                 | –                      |

#### Правила взаимодействия

1. **UI-логика — только L1–L2.** Слои L3–L5 не знают, как их данные отображаются.
2. **Не перепрыгивай уровни.** View → ViewModel → Helpers → Repository.
3. **Инжекция зависит от уровня:**

   * ViewModel ← Helpers
   * Helper ← Repository
4. ViewModel **не обращается** к доменным объектам напрямую — пользуется Helpers.
5. **Реактивность:** все `Reactive`-свойства (ReactiveUI, Fody `[Reactive]`) живут **только** в L2.
6. **Модели L4** должны оставаться максимально чистыми: никакой логики, кроме вычисляемых `get`-свойств.
7. **Helpers (L3)** оповещают ViewModel (L2) об изменениях через **шину сообщений** (например, `IMessageBus` ReactiveUI или собственный событие-агрегатор).

---