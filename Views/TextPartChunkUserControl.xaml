<UserControl x:Class="DocCreator01.Views.TextPartChunkUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:DocCreator01.Converters"
             Height="Auto" Width="Auto">
    <UserControl.Resources>
        <converters:ByteArrayToImageSourceConverter x:Key="ByteArrayToImageConverter"/>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid Margin="0,5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" MinWidth="50" />
            <ColumnDefinition Width="Auto" MinWidth="24" />
        </Grid.ColumnDefinitions>
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Изображение (показывается только если есть) -->
        <Border Grid.Column="0" Grid.Row="0" 
                Margin="5,0,5,5"
                BorderBrush="LightGray" 
                BorderThickness="1"
                CornerRadius="3"
                Visibility="{Binding HasImage, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Image Source="{Binding ThumbnailImage}" 
                       MaxHeight="150" 
                       MaxWidth="200"
                       Stretch="Uniform"
                       HorizontalAlignment="Left"
                       VerticalAlignment="Top"
                       Margin="3"/>
                       
                <!-- Кнопка удаления изображения -->
                <Button Content="✕" 
                        Width="20" Height="20"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Margin="3"
                        Background="Red"
                        Foreground="White"
                        FontSize="12"
                        ToolTip="Удалить изображение"
                        Click="OnRemoveImageClick"/>
            </Grid>
        </Border>

        <!-- Текстовое поле -->
        <ScrollViewer Grid.Column="0" Grid.Row="1"
                      HorizontalScrollBarVisibility="Auto" 
                      VerticalScrollBarVisibility="Auto">
            <TextBox x:Name="PART_TextBox"
                     Text="{Binding Text, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Padding="5"
                     HorizontalAlignment="Stretch"
                     VerticalAlignment="Stretch"
                     TextChanged="OnTextChanged"
                     PreviewKeyDown="OnPreviewKeyDown">
                <TextBox.Style>
                    <Style TargetType="TextBox">
                        <!-- intentionally left empty to clear default hover style -->
                    </Style>
                </TextBox.Style>
            </TextBox>
        </ScrollViewer>

        <!-- Кнопка удаления чанка -->
        <Button Grid.Column="1" Grid.Row="0" Grid.RowSpan="2"
                Content="[x]"
                Width="20" Height="20"
                Margin="2,0,0,0"
                VerticalAlignment="Top"
                HorizontalAlignment="Center"
                ToolTip="Delete"
                Command="{Binding DataContext.DeleteChunkCommand, 
                          RelativeSource={RelativeSource AncestorType=ListView}}"
                CommandParameter="{Binding}"/>
    </Grid>
</UserControl>
